(()=>{var t={n:o=>{var e=o&&o.__esModule?()=>o.default:()=>o;return t.d(e,{a:e}),e},d:(o,e)=>{for(var n in e)t.o(e,n)&&!t.o(o,n)&&Object.defineProperty(o,n,{enumerable:!0,get:e[n]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o)};(()=>{"use strict";const o=flarum.core.compat["common/app"];t.n(o)().initializers.add("shebaoting/money",(function(){console.log("[shebaoting/money] Hello, forum and admin!")}));const e=flarum.core.compat["forum/app"];var n=t.n(e);const s=flarum.core.compat.extend,r=flarum.core.compat["components/UserCard"];var a=t.n(r);const i=flarum.core.compat["utils/UserControls"];var l=t.n(i);const u=flarum.core.compat["components/Button"];var c=t.n(u);const d=flarum.core.compat["components/LinkButton"];var p=t.n(d);function f(t,o){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},f(t,o)}function g(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,f(t,o)}const h=flarum.core.compat["components/Modal"];var y=t.n(h);const b=flarum.core.compat["utils/Stream"];var v=t.n(b),_=function(t){function o(){return t.apply(this,arguments)||this}g(o,t);var e=o.prototype;return e.oninit=function(o){t.prototype.oninit.call(this,o),this.money=v()(this.attrs.user.data.attributes.money||0)},e.className=function(){return"UserMoneyModal Modal--small"},e.title=function(){return app.translator.trans("shebaoting-money.forum.modal.title",{user:this.attrs.user})},e.content=function(){var t=app.forum.attribute("shebaoting-money.moneyname")||"[money]";return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,app.translator.trans("shebaoting-money.forum.modal.current")," ",t.replace("[money]",this.attrs.user.data.attributes.money)),m("input",{required:!0,className:"FormControl",type:"number",step:"any",bidi:this.money})),m("div",{className:"Form-group"},c().component({className:"Button Button--primary",type:"submit",loading:this.loading},app.translator.trans("shebaoting-money.forum.modal.submit_button")))))},e.onsubmit=function(t){var o=this;t.preventDefault(),this.loading=!0,this.attrs.user.save({money:this.money()},{errorHandler:this.onerror.bind(this)}).then(this.hide.bind(this)).catch((function(){o.loading=!1,m.redraw()}))},o}(y());const k=flarum.core.compat.Model;var M=t.n(k);const N=flarum.core.compat["models/User"];var L=t.n(N);const U=flarum.core.compat["utils/PostControls"];var w=t.n(U);const x=flarum.core.compat["forum/components/UserPage"];var B=t.n(x);const P=flarum.core.compat["common/components/LoadingIndicator"];var O=t.n(P);const j=flarum.core.compat["common/components/Placeholder"];var A=t.n(j),C=function(t){function o(){return t.apply(this,arguments)||this}g(o,t);var e=o.prototype;return e.oninit=function(o){if(t.prototype.oninit.call(this,o),this.loading=!0,this.logs=[],this.page=0,this.moreResults=!0,!n().session.user)return n().alerts.show({type:"error"},n().translator.trans("core.forum.error.not_authenticated")),void m.route.set(n().route("index"));this.user=n().session.user,this.onuserloaded()},e.onuserloaded=function(){this.loadLogs()},e.loadLogs=function(){var t=this;this.moreResults&&(this.loading=!0,n().store.find("money-log",{page:{offset:20*this.page}}).then((function(o){console.log("logs",o),t.logs=t.logs.concat(o),t.loading=!1,t.page++,o.length<20&&(t.moreResults=!1),m.redraw()})).catch((function(o){console.error("Error loading logs:",o),t.loading=!1,m.redraw()})))},e.content=function(){var t=this;return m("div",{className:"UserMoneyLogPage"},this.loading&&0===this.logs.length?m(O(),null):0===this.logs.length?m(A(),{text:n().translator.trans("shebaoting-money.forum.point_log.empty_text")}):m("div",{className:"UserMoneyLogPage-content"},m("table",{className:"NotificationGrid"},m("thead",null,m("tr",null,m("th",null,m("i",{"aria-hidden":"true",className:"icon fas fa-clock"}),n().translator.trans("shebaoting-money.forum.point_log.table.headers.date")),m("th",null,m("i",{"aria-hidden":"true",className:"icon fas fa-list"}),n().translator.trans("shebaoting-money.forum.point_log.table.headers.amount")),m("th",null,m("i",{"aria-hidden":"true",className:"icon fas fa-coins"}),n().translator.trans("shebaoting-money.forum.point_log.table.headers.balance")),m("th",null,m("i",{"aria-hidden":"true",className:"icon fas fa-info-circle"}),n().translator.trans("shebaoting-money.forum.point_log.table.headers.reason")))),m("tbody",null,this.logs.map((function(t){console.log(t);var o=t.action(),e="",s=t.balance(),r=new Date(t.createdAt()).toLocaleString(),a=t.amount();if("post"===o){var i=t.discussion(),l=i?i.title:"",u=i?n().route("discussion",{id:i.id,slug:i.slug}):"#";e=n().translator.trans("shebaoting-money.forum.logs_description.created_discussion",{title:l,url:u})}else if("reply"===o){var c=t.discussion(),d=c?c.title:"",p=c?n().route("discussion",{id:c.id,slug:c.slug}):"#";e=n().translator.trans("shebaoting-money.forum.logs_description.created_reply",{title:d,url:p})}else if("reply_received"===o){var f=t.targetUser(),g=f?f.username:"",h=t.discussion(),y=h?h.title:"",b=h?n().route("discussion",{id:h.id,slug:h.slug}):"#";e=n().translator.trans("shebaoting-money.forum.logs_description.reply_received",{username:g,title:y,url:b})}else if("like"===o){var v=t.discussion(),_=v?v.title:"",k=v?n().route("discussion",{id:v.id,slug:v.slug}):"#";e=n().translator.trans("shebaoting-money.forum.logs_description.liked_post",{title:_,url:k})}else if("liked_by"===o){var M=t.targetUser(),N=M?M.username:"",L=t.discussion(),U=L?L.title:"",w=L?n().route("discussion",{id:L.id,slug:L.slug}):"#";e=n().translator.trans("shebaoting-money.forum.logs_description.liked_by",{username:N,title:U,url:w})}else if("unlike"===o){var x=t.discussion(),B=x?x.title:"",P=x?n().route("discussion",{id:x.id,slug:x.slug}):"#";e=n().translator.trans("shebaoting-money.forum.logs_description.unliked_post",{title:B,url:P})}else if("unliked_by"===o){var O=t.targetUser(),j=O?O.username:"",A=t.discussion(),C=A?A.title:"",F=A?n().route("discussion",{id:A.id,slug:A.slug}):"#";e=n().translator.trans("shebaoting-money.forum.logs_description.unliked_by",{username:j,title:C,url:F})}else e=t.reason();return console.log("discussion",t.discussion()),console.log("description",e,typeof e),m("tr",{key:t.id()},m("td",null,r),m("td",null,a),m("td",null,s),m("td",null,m.trust(e))," ")})))),this.moreResults&&m("div",{className:"UserMoneyLogPage-loadMore"},m("button",{className:"Button Button--primary",onclick:function(){return t.loadLogs()}},n().translator.trans("shebaoting-money.forum.point_log.load_more")))))},o}(B());const F=flarum.core.compat["common/Model"];var R=t.n(F),E=function(t){function o(){for(var o,e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return(o=t.call.apply(t,[this].concat(n))||this).createdAt=R().attribute("createdAt",R().transformDate),o.balance=R().attribute("balance"),o.amount=R().attribute("amount"),o.reason=R().attribute("reason"),o.action=R().attribute("action"),o.targetUser=R().attribute("targetUser"),o.post=R().attribute("post"),o.discussion=R().attribute("discussion"),o}return g(o,t),o}(R());n().initializers.add("shebaoting-money",(function(){n().store.models["money-logs"]=E,L().prototype.canEditMoney=M().attribute("canEditMoney"),n().routes["user.money-log"]={path:"/u/:username/money-log",component:C},(0,s.extend)(a().prototype,"infoItems",(function(t){var o=this.attrs.user.data.attributes.money||0,e=n().forum.attribute("shebaoting-money.moneyname")||"[money]",s=(n().forum.attribute("shebaoting-money.level_names")||"").split(","),r=parseInt(n().forum.attribute("shebaoting-money.money_scale")||"100");if(s.length>1&&""!==s[0]){for(var a=o,i=[],l=0;l<s.length;l++){var u=Math.floor(a/Math.pow(r,s.length-1-l));a%=Math.pow(r,s.length-1-l),i.push(m("span",{style:{marginRight:"15px"}},s[l]+" "+u))}t.add("money",m("div",i))}else t.add("money",m("span",e.replace("[money]",o)))})),(0,s.extend)(B().prototype,"navItems",(function(t){var o=this.user;n().session.user&&n().session.user.id()===o.id()&&t.add("moneyLogs",p().component({href:n().route("user.money-log",{username:o.username()}),name:"moneyLogs",icon:"fas fa-coins"},n().translator.trans("shebaoting-money.forum.point_log.link")),10)})),(0,s.extend)(l(),"moderationControls",(function(t,o){o.canEditMoney()&&t.add("money",c().component({icon:"fas fa-money-bill",onclick:function(){return n().modal.show(_,{user:o})}},n().translator.trans("shebaoting-money.forum.user_controls.money_button")))})),(0,s.extend)(w(),"likeAction",(function(t,o){var e=n().session.user,s=parseFloat(n().forum.attribute("shebaoting-money.moneyforlike")||0);s<0&&e.money<Math.abs(s)?t.add("like",c().component({icon:"fas fa-thumbs-up",className:"Button Button--link",onclick:function(){alert(n().translator.trans("shebaoting-money.forum.errors.not_enough_money"))}},n().translator.trans("core.forum.post.like_link")),20):t.add("like",c().component({icon:"fas fa-thumbs-up",className:"Button Button--link",onclick:function(){o.save({isLiked:!o.isLiked()})}},n().translator.trans("core.forum.post.like_link")),20)}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map